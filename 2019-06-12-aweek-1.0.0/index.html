<!DOCTYPE html>
<html lang="en">
  <!-- Beautiful Jekyll | MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Handling non-standard weekly data in R</title>

  <meta name="author" content="RECON - R Epidemics Consortium" />
  
  
  <meta name="description" content="An overview of 'aweek', the lightweight R package for handling weekly data">
  

  <link rel="alternate" type="application/rss+xml" title="R Epidemics Consortium - We are a group of international experts in infectious disease modelling, Public Health, and software development who collaborate to create the next generation of analysis tools for disease outbreak response using the R software" href="/feed.xml" />

  
    
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
    
      
  
  
    
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/css/main.css" />
    
      <link rel="stylesheet" href="/css/recon.css" />
    
    
  
  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

    
  
  

  

  <!-- Facebook OpenGraph tags -->
  <meta property="og:title" content="Handling non-standard weekly data in R" />
  <meta property="og:type" content="website" />
  
  <meta property="og:url" content="http://reconhub.github.io/2019-06-12-aweek-1.0.0/" />
  
  
  <meta property="og:image" content="" />
  
  
  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@yourname" />
  <meta name="twitter:creator" content="@yourname" />
  <meta name="twitter:title" content="Handling non-standard weekly data in R" />
  <meta name="twitter:description" content="This week (2019-W24-2), the aweek package version 1.0.0 has been released on CRAN. The aweek package is a response to the lack of utilities to easily define weeks that do not start on Monday, which is necessary for outbreak response in countries whose calendars may start on Sunday or Saturday...." />
  
  
</head>


  <body>
  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://reconhub.github.io">R Epidemics Consortium</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">About RECON</a>
            <div class="navlinks-children">
              
                
                  
            





<a href="/">What we do</a>

                
              
                
                  
            





<a href="/join">Join us</a>

                
              
                
                  
            





<a href="/contact">Contact</a>

                
              
                
                  
            





<a href="/CODE_OF_CONDUCT">Code of Conduct</a>

                
              
            </div>
          </li>
        
        
        
          <li>
            
            





<a href="/blog">News</a>

          </li>
        
        
        
          <li>
            
            





<a href="/people">People</a>

          </li>
        
        
        
          <li>
            
            





<a href="/projects">Projects</a>

          </li>
        
        
        
          <li>
            
            





<a href="/resources">Resources</a>

          </li>
        
        
        
          <li>
            
            





<a href="/events">Events</a>

          </li>
        
        
        
          <li>
            
            





<a href="/funding">Funding</a>

          </li>
        
        
        
          <li>
            
            





<a href="/forum">Forum</a>

          </li>
        
        
      </ul>
    </div>

	

  </div>
</nav>


    <!-- TODO this file has become a mess, refactor it -->





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Handling non-standard weekly data in R</h1>
		  
		    
			<h2 class="post-subheading">An overview of 'aweek', the lightweight R package for handling weekly data</h2>
			
		  
		  
		  
		  <span class="post-meta">Posted on June 12, 2019</span>
		  
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

      <article role="main" class="blog-post">
        <p>This week (2019-W24-2), the <a href="../aweek"><em>aweek</em> package</a> version 1.0.0
has been <a href="https://cran.r-project.org/package=aweek">released on CRAN</a>.</p>

<p>The <em>aweek</em> package is a response to the lack of utilities to easily
define weeks that do not start on Monday, which is necessary for
outbreak response in <a href="https://en.wikipedia.org/wiki/File:First_Day_of_Week_World_Map.svg">countries whose calendars may start on Sunday or
Saturday</a>.
This package provides utilities to convert dates to weeks and back again
with any week start definition.</p>

<p>You can install <em>aweek</em> with:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"aweek"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Using aweek is straightforward. When you load the package, you can set
the day on which all weeks should start with <code class="language-plaintext highlighter-rouge">set_week_start()</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"aweek"</span><span class="p">)</span><span class="w">
</span><span class="c1"># At the beginning of your analysis, set the week start to the weeks you want</span><span class="w">
</span><span class="c1"># to use for reporting</span><span class="w">
</span><span class="n">ow</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">set_week_start</span><span class="p">(</span><span class="s2">"Sunday"</span><span class="p">)</span><span class="w">
</span><span class="n">d</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2019-06-11"</span><span class="p">)</span><span class="w">
</span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.aweek</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="w"> </span><span class="c1"># convert dates to weeks</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## &lt;aweek start: Sunday&gt;
## [1] "2019-W24-3"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">as.Date</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w">         </span><span class="c1"># convert weeks to dates</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] "2019-06-11"
</code></pre></div></div>

<p>All aweek objects carry a <code class="language-plaintext highlighter-rouge">week_start</code> attribute, which is the ISO week
day that defines the start of the week for that object.</p>

<p>One of the common things you might want to do is to define a range of
dates to use to filter linelist data. You can use <code class="language-plaintext highlighter-rouge">get_date()</code> to get a
date from week numbers. Note that day in this context refers to the day
of the week relative to the week start, so a “7” is “Saturday”.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"dplyr"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"tidyr"</span><span class="p">)</span><span class="w">
</span><span class="n">linelist</span><span class="w">   </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as_tibble</span><span class="p">(</span><span class="n">outbreaks</span><span class="o">::</span><span class="n">ebola_sim_clean</span><span class="o">$</span><span class="n">linelist</span><span class="p">)</span><span class="w">
</span><span class="n">linelist</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 5,829 x 11
##    case_id generation date_of_infecti… date_of_onset date_of_hospita…
##    &lt;chr&gt;        &lt;int&gt; &lt;date&gt;           &lt;date&gt;        &lt;date&gt;          
##  1 d1fafd           0 NA               2014-04-07    2014-04-17      
##  2 53371b           1 2014-04-09       2014-04-15    2014-04-20      
##  3 f5c3d8           1 2014-04-18       2014-04-21    2014-04-25      
##  4 6c286a           2 NA               2014-04-27    2014-04-27      
##  5 0f58c4           2 2014-04-22       2014-04-26    2014-04-29      
##  6 49731d           0 2014-03-19       2014-04-25    2014-05-02      
##  7 f9149b           3 NA               2014-05-03    2014-05-04      
##  8 881bd4           3 2014-04-26       2014-05-01    2014-05-05      
##  9 e66fa4           2 NA               2014-04-21    2014-05-06      
## 10 20b688           3 NA               2014-05-05    2014-05-06      
## # … with 5,819 more rows, and 6 more variables: date_of_outcome &lt;date&gt;,
## #   outcome &lt;fct&gt;, gender &lt;fct&gt;, hospital &lt;fct&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">obs_start</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_date</span><span class="p">(</span><span class="n">week</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2014</span><span class="p">,</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] "2014-03-02"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">obs_end</span><span class="w">   </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_date</span><span class="p">(</span><span class="n">week</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2014</span><span class="p">,</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] "2014-10-04"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll_obs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">linelist</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">date_of_onset</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">obs_start</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">date_of_onset</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">obs_end</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">hospital</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"other"</span><span class="p">)</span><span class="w">
</span><span class="n">ll_obs</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 344 x 11
##    case_id generation date_of_infecti… date_of_onset date_of_hospita…
##    &lt;chr&gt;        &lt;int&gt; &lt;date&gt;           &lt;date&gt;        &lt;date&gt;          
##  1 f5c3d8           1 2014-04-18       2014-04-21    2014-04-25      
##  2 0f58c4           2 2014-04-22       2014-04-26    2014-04-29      
##  3 e66fa4           2 NA               2014-04-21    2014-05-06      
##  4 2ae019           3 NA               2014-05-06    2014-05-11      
##  5 72b905           4 2014-05-06       2014-05-12    2014-05-13      
##  6 5fe599           4 2014-05-08       2014-05-13    2014-05-15      
##  7 dce5cc           4 2014-05-03       2014-05-17    2014-05-18      
##  8 d4ff47           6 2014-05-14       2014-05-17    2014-05-20      
##  9 49d786           3 NA               2014-05-20    2014-05-24      
## 10 76b97a           2 2014-05-11       2014-05-16    2014-05-25      
## # … with 334 more rows, and 6 more variables: date_of_outcome &lt;date&gt;,
## #   outcome &lt;fct&gt;, gender &lt;fct&gt;, hospital &lt;fct&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;
</code></pre></div></div>

<p>You can use aweek to aggregate weekly data. The default aweek object is
in the ISO 8601 format (YYYY-Www-d) and <code class="language-plaintext highlighter-rouge">factor_aweek()</code> can remove the
<code class="language-plaintext highlighter-rouge">-d</code> portion, giving weekly aggregates, which will include any missing
weeks in the levels:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll_obs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">week</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.aweek</span><span class="p">(</span><span class="n">date_of_onset</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">aggregate_week</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor_aweek</span><span class="p">(</span><span class="n">week</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">aggregate_week</span><span class="p">,</span><span class="w"> </span><span class="n">gender</span><span class="p">,</span><span class="w"> </span><span class="n">.drop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">spread</span><span class="p">(</span><span class="n">gender</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 24 x 3
##    aggregate_week     f     m
##    &lt;fct&gt;          &lt;int&gt; &lt;int&gt;
##  1 2014-W17           2     1
##  2 2014-W18           0     0
##  3 2014-W19           0     1
##  4 2014-W20           2     3
##  5 2014-W21           0     1
##  6 2014-W22           1     2
##  7 2014-W23           2     1
##  8 2014-W24           1     1
##  9 2014-W25           2     2
## 10 2014-W26           3     0
## # … with 14 more rows
</code></pre></div></div>

      </article>

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">

  <!--- Share on Twitter -->
  
    <a href="https://twitter.com/intent/tweet?text=http://reconhub.github.io/2019-06-12-aweek-1.0.0/"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fa fa-fw fa-twitter" aria-hidden="true"></span>
    </a>
  

  <!--- Share on Facebook -->
  
    <a href="https://www.facebook.com/sharer/sharer.php?u=http://reconhub.github.io/2019-06-12-aweek-1.0.0/"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fa fa-fw fa-facebook" aria-hidden="true"></span>
    </a>
  

  <!--- Share on Google Plus -->
  

  <!--- Share on LinkedIn -->
  
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://reconhub.github.io/2019-06-12-aweek-1.0.0/"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fa fa-fw fa-linkedin" aria-hidden="true"></span>
    </a>
  

</section>


      

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="/2018-10-18-RECON-NGO/" data-toggle="tooltip" data-placement="top" title="RECON 2.0: going official">&larr; Previous Post</a>
        </li>
        
        
        <li class="next">
          <a href="/2020-01-08-aminata-deployment/" data-toggle="tooltip" data-placement="top" title="RECON first deployee via GOARN">Next Post &rarr;</a>
        </li>
        
      </ul>

      
        <div class="disqus-comments">
          
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">
	    var disqus_shortname = 'reconhub-github-io';
	    // ensure that pages with query string get the same discussion
            var url_parts = window.location.href.split("?");
            var disqus_url = url_parts[0];	    
	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>


        </div>
      
    </div>
  </div>
</div>

    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
		    
          <li>
            <a href="mailto:thibautjombart@gmail.com" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
        
        
          <li>
            <a href="https://github.com/reconhub/reconhub.github.io" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
        
          

		  
      
		  
        </ul>
        <p class="copyright text-muted">
		  RECON - R Epidemics Consortium
		  &nbsp;&bull;&nbsp;
		  2024
	    </p>
		<p class="theme-by text-muted">
		  Theme by
		  <a href="http://deanattali.com/">Dean Attali</a>
		</p>
      </div>
    </div>
  </div>
</footer>

  
    






  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script>
      	if (typeof jQuery == 'undefined') {
      	  document.write('<script src="/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
      	}
      </script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/js/bootstrap.min.js"></script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/js/main.js"></script>
    
  



	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-83713279-1', 'auto');
		ga('send', 'pageview');
	</script>
	<!-- End Google Analytics -->


  
  </body>
</html>
